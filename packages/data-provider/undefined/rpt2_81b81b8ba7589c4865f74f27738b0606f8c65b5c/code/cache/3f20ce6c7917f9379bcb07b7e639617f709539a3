{"code":"import { __assign, __awaiter, __generator } from \"tslib\";\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport axios from 'axios';\nimport { setTokenHeader } from './headers-helpers';\nimport * as endpoints from './api-endpoints';\nfunction _get(url, options) {\n    return __awaiter(this, void 0, void 0, function () {\n        var response;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, axios.get(url, __assign({}, options))];\n                case 1:\n                    response = _a.sent();\n                    return [2 /*return*/, response.data];\n            }\n        });\n    });\n}\nfunction _post(url, data) {\n    return __awaiter(this, void 0, void 0, function () {\n        var response;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, axios.post(url, JSON.stringify(data), {\n                        headers: { 'Content-Type': 'application/json' },\n                    })];\n                case 1:\n                    response = _a.sent();\n                    return [2 /*return*/, response.data];\n            }\n        });\n    });\n}\nfunction _postMultiPart(url, formData, options) {\n    return __awaiter(this, void 0, void 0, function () {\n        var response;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, axios.post(url, formData, __assign(__assign({}, options), { headers: { 'Content-Type': 'multipart/form-data' } }))];\n                case 1:\n                    response = _a.sent();\n                    return [2 /*return*/, response.data];\n            }\n        });\n    });\n}\nfunction _put(url, data) {\n    return __awaiter(this, void 0, void 0, function () {\n        var response;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, axios.put(url, JSON.stringify(data), {\n                        headers: { 'Content-Type': 'application/json' },\n                    })];\n                case 1:\n                    response = _a.sent();\n                    return [2 /*return*/, response.data];\n            }\n        });\n    });\n}\nfunction _delete(url) {\n    return __awaiter(this, void 0, void 0, function () {\n        var response;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, axios.delete(url)];\n                case 1:\n                    response = _a.sent();\n                    return [2 /*return*/, response.data];\n            }\n        });\n    });\n}\nfunction _deleteWithOptions(url, options) {\n    return __awaiter(this, void 0, void 0, function () {\n        var response;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, axios.delete(url, __assign({}, options))];\n                case 1:\n                    response = _a.sent();\n                    return [2 /*return*/, response.data];\n            }\n        });\n    });\n}\nfunction _patch(url, data) {\n    return __awaiter(this, void 0, void 0, function () {\n        var response;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, axios.patch(url, JSON.stringify(data), {\n                        headers: { 'Content-Type': 'application/json' },\n                    })];\n                case 1:\n                    response = _a.sent();\n                    return [2 /*return*/, response.data];\n            }\n        });\n    });\n}\nvar isRefreshing = false;\nvar failedQueue = [];\nvar refreshToken = function (retry) { return _post(endpoints.refreshToken(retry)); };\nvar processQueue = function (error, token) {\n    if (token === void 0) { token = null; }\n    failedQueue.forEach(function (prom) {\n        if (error) {\n            prom.reject(error);\n        }\n        else {\n            prom.resolve(token);\n        }\n    });\n    failedQueue = [];\n};\naxios.interceptors.response.use(function (response) { return response; }, function (error) { return __awaiter(void 0, void 0, void 0, function () {\n    var originalRequest, token, err_1, token, err_2;\n    var _a;\n    return __generator(this, function (_b) {\n        switch (_b.label) {\n            case 0:\n                originalRequest = error.config;\n                if (!(error.response.status === 401 && !originalRequest._retry)) return [3 /*break*/, 13];\n                originalRequest._retry = true;\n                if (!isRefreshing) return [3 /*break*/, 5];\n                _b.label = 1;\n            case 1:\n                _b.trys.push([1, 4, , 5]);\n                return [4 /*yield*/, new Promise(function (resolve, reject) {\n                        failedQueue.push({ resolve: resolve, reject: reject });\n                    })];\n            case 2:\n                token = _b.sent();\n                originalRequest.headers['Authorization'] = 'Bearer ' + token;\n                return [4 /*yield*/, axios(originalRequest)];\n            case 3: return [2 /*return*/, _b.sent()];\n            case 4:\n                err_1 = _b.sent();\n                return [2 /*return*/, Promise.reject(err_1)];\n            case 5:\n                isRefreshing = true;\n                _b.label = 6;\n            case 6:\n                _b.trys.push([6, 11, 12, 13]);\n                return [4 /*yield*/, refreshToken(\n                    // Handle edge case where we get a blank screen if the initial 401 error is from a refresh token request\n                    ((_a = originalRequest.url) === null || _a === void 0 ? void 0 : _a.includes('api/auth/refresh')) ? true : false)];\n            case 7:\n                token = (_b.sent()).token;\n                if (!token) return [3 /*break*/, 9];\n                originalRequest.headers['Authorization'] = 'Bearer ' + token;\n                setTokenHeader(token);\n                window.dispatchEvent(new CustomEvent('tokenUpdated', { detail: token }));\n                processQueue(null, token);\n                return [4 /*yield*/, axios(originalRequest)];\n            case 8: return [2 /*return*/, _b.sent()];\n            case 9:\n                window.location.href = '/login';\n                _b.label = 10;\n            case 10: return [3 /*break*/, 13];\n            case 11:\n                err_2 = _b.sent();\n                processQueue(err_2, null);\n                return [2 /*return*/, Promise.reject(err_2)];\n            case 12:\n                isRefreshing = false;\n                return [7 /*endfinally*/];\n            case 13: return [2 /*return*/, Promise.reject(error)];\n        }\n    });\n}); });\nexport default {\n    get: _get,\n    post: _post,\n    postMultiPart: _postMultiPart,\n    put: _put,\n    delete: _delete,\n    deleteWithOptions: _deleteWithOptions,\n    patch: _patch,\n    refreshToken: refreshToken,\n};\n//# sourceMappingURL=request.js.map","references":["/home/lau/dev-projects/Chocolatine/node_modules/axios/index.d.ts","/home/lau/dev-projects/Chocolatine/packages/data-provider/src/headers-helpers.ts","/home/lau/dev-projects/Chocolatine/packages/data-provider/src/api-endpoints.ts"],"map":"{\"version\":3,\"file\":\"request.js\",\"sourceRoot\":\"\",\"sources\":[\"../../src/request.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/home/lau/dev-projects/Chocolatine/packages/data-provider/dist/types/request.d.ts","writeByteOrderMark":false,"text":"import { AxiosRequestConfig } from 'axios';\ndeclare function _get<T>(url: string, options?: AxiosRequestConfig): Promise<T>;\ndeclare function _post(url: string, data?: any): Promise<any>;\ndeclare function _postMultiPart(url: string, formData: FormData, options?: AxiosRequestConfig): Promise<any>;\ndeclare function _put(url: string, data?: any): Promise<any>;\ndeclare function _delete<T>(url: string): Promise<T>;\ndeclare function _deleteWithOptions<T>(url: string, options?: AxiosRequestConfig): Promise<T>;\ndeclare function _patch(url: string, data?: any): Promise<any>;\ndeclare const _default: {\n    get: typeof _get;\n    post: typeof _post;\n    postMultiPart: typeof _postMultiPart;\n    put: typeof _put;\n    delete: typeof _delete;\n    deleteWithOptions: typeof _deleteWithOptions;\n    patch: typeof _patch;\n    refreshToken: (retry?: boolean | undefined) => Promise<any>;\n};\nexport default _default;\n"}}
